import nmap
from host import *
from json_parser import *

TCP = 'tcp'
UDP = 'udp'


ip = '192.168.1.115'
newHost = Host(ip)
print(newHost.IP)

nm = nmap.PortScanner()
print("Scanning:")
#nm.scan('njlochner.com')
nm.scan(ip)
#print(nm.scaninfo())
protocols = nm[ip].all_protocols()
#print(protocols)

#for protocol in protocols:
#	print(nm[ip][protocol].keys())

if TCP in protocols:
	TCP_ports = nm[ip][TCP].keys()
	print(TCP_ports)
	print(nm[ip][TCP])
	for port in TCP_ports:
		state = nm[ip][TCP][port]['state']
		name = nm[ip][TCP][port]['name']
		product = nm[ip][TCP][port]['product']
		print("port: " + str(port) + ", state: " + str(state) + ", name: " + str(name) + ", product: " + str(product))
		newHost.addService(port, name=name, state=state, product=product)

print(newHost.services)
#for service in newHost.services:
#	print(str(service.port) + str(service.get()))

#print(nm[ip]['tcp'])
#print(nm[ip]['udp'])

save_json(newHost, "save.json")